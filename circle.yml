machine:
  environment:
    APPNAME: FlyveMDMInventoryAgent
    APP_IDENTIFIER: org.flyve.inventory.agent
    XCODE_SCHEME: FlyveMDMInventoryAgent
    XCODE_SCHEME_UI: FlyveMDMInventoryAgentUITests
    XCODE_WORKSPACE: FlyveMDMInventoryAgent.xcworkspace
    KEYCHAIN_NAME: ios-app.keychain
    SCRIPT_PATH: ./ci/scripts
    CERTIFICATES_PATH: ./ci/cert
  xcode:
    version: 9.0
general:
  branches:
    ignore:
      - gh-pages
checkout:
  post:
    - git tag | xargs git tag -d
    - git fetch origin --tags
    - git tag
dependencies:
  pre:
    - source "${SCRIPT_PATH}/bundler_config.sh"
  override:
    - source "${SCRIPT_PATH}/install.sh"
test:
  pre:
    - source "${SCRIPT_PATH}/fastlane_config.sh"
    - source "${SCRIPT_PATH}/git_config.sh"
    - source "${SCRIPT_PATH}/keychain_add.sh"
  override:
    - source "${SCRIPT_PATH}/test.sh"
deployment:
  deploy_develop:
    branch: develop
    commands:
      - source "${SCRIPT_PATH}/transifex.sh"
      - source "${SCRIPT_PATH}/deploy_develop.sh"
      - source "${SCRIPT_PATH}/keychain_remove.sh"
  deploy_master:
    branch: master
    commands:
      - source "${SCRIPT_PATH}/transifex.sh"
      - source "${SCRIPT_PATH}/deploy_master.sh"
      - source "${SCRIPT_PATH}/keychain_remove.sh"
